{% load static %}
{% load i18n %}


{% load basket_tags %}
{% load reviews_tags %}
{% load display_tags %}
{% load product_tags %}
{% load image_tags %}
{% load custom_product_tags %}

<!-- End of Main Content -->
    <div class="sidebar-overlay"></div>
    <a class="sidebar-close" href="#"><i class="close-icon"></i></a>
    <a href="#" class="sidebar-toggle d-flex d-lg-none"><i class="fas fa-chevron-left"></i></a>
    <div class="sidebar-content scrollable">
        <div class="sticky-sidebar">
            <div class="widget widget-icon-box mb-6">
                <div class="icon-box icon-box-side">
                    <span class="icon-box-icon text-dark">
                        <i class="w-icon-truck"></i>
                    </span>
                    <div class="icon-box-content">
                        <h4 class="icon-box-title">{% trans "Free Shipping & Returns" %}</h4>
                        <p>{% trans "For all orders over $99" %}</p>
                    </div>
                </div>
                <div class="icon-box icon-box-side">
                    <span class="icon-box-icon text-dark">
                        <i class="w-icon-bag"></i>
                    </span>
                    <div class="icon-box-content">
                        <h4 class="icon-box-title">{% trans "Secure Payment" %}</h4>
                        <p>{% trans "We ensure secure payment" %}</p>
                    </div>
                </div>
                <div class="icon-box icon-box-side">
                    <span class="icon-box-icon text-dark">
                        <i class="w-icon-money"></i>
                    </span>
                    <div class="icon-box-content">
                        <h4 class="icon-box-title">{% trans "Money Back Guarantee" %}</h4>
                        <p>{% trans "Any back within 30 days" %}</p>
                    </div>
                </div>
            </div>
            <!-- End of Widget Icon Box -->

            <div class="widget widget-banner mb-9">
                <div class="banner banner-fixed br-sm">
                    <figure>
                        <img src="{% static 'assets/images/shop/banner3.jpg' %}" alt="Banner" width="266"
                            height="220" style="background-color: #1D2D44;" />
                    </figure>
                    <div class="banner-content">
                        <div class="banner-price-info font-weight-bolder text-white lh-1 ls-25">
                            40<sup class="font-weight-bold">%</sup><sub
                                class="font-weight-bold text-uppercase ls-25">Off</sub>
                        </div>
                        <h4
                            class="banner-subtitle text-white font-weight-bolder text-uppercase mb-0">
                            Ultimate Sale</h4>
                    </div>
                </div>
            </div>
            <!-- End of Widget Banner -->

            <div class="widget widget-products">
                <div class="title-link-wrapper mb-2">
                    <h4 class="title title-link font-weight-bold">{% trans "More Products" %}</h4>
                </div>

                <div class="swiper nav-top">
                    <div class="swiper-container swiper-theme nav-top" data-swiper-options = "{
                        'slidesPerView': 1,
                        'spaceBetween': 20,
                        'navigation': {
                            'prevEl': '.swiper-button-prev',
                            'nextEl': '.swiper-button-next'
                        }
                    }">
                        <div class="swiper-wrapper">
                            {% all_products as products %}
                            {% for product in products %}
                            {% if forloop.counter0|divisibleby:3 %}
                            <div class="widget-col swiper-slide">
                            {% endif %}
                                <div class="product product-widget">
                                    {% with image=product.primary_image %}
                                    {% oscar_thumbnail image.original "100x113" upscale=False as thumb %}
                                    <figure class="product-media">
                                        <a href="{{ product.get_absolute_url }}">
                                            <img src="{{ thumb.url }}" alt="{{ product.get_title }}" class="img-thumbnail w-auto mx-auto my-0" width="100" height="130">
                                        </a>
                                    </figure>
                                    {% endwith %}
                                    <div class="product-details">
                                        <h4 class="product-name">
                                            <a href="{{ product.get_absolute_url }}">{{ product.title }}</a>
                                        </h4>
                                        {% iffeature "reviews" %}
                                        <div class="ratings-container">
                                            <div class="ratings-full">
                                                <!-- Check if the product has a rating, else set width to 0% -->
                                                <span class="ratings" style="width: {% if product.rating %}{% widthratio product.rating 5 100 %}{% else %}0{% endif %}%;"></span>
                                                <span class="tooltiptext tooltip-top">
                                                    {% if product.rating %}
                                                        {{ product.rating|floatformat:2 }} out of 5
                                                    {% else %}
                                                        No rating available
                                                    {% endif %}
                                                </span>
                                            </div>
                                            <a href="{{ product.get_absolute_url }}#reviews" class="rating-reviews">({{ product.reviews.count }} reviews)</a>
                                        </div>
                                        {% endiffeature %}
                                        
                                        <div class="product-price">{% include "oscar/catalogue/partials/stock_record.html" %}</div>
                                    </div>
                                </div>
                            {% if forloop.counter|divisibleby:3 or forloop.last %}
                            <!-- Close the current slide when a group of 3 products is complete -->
                            </div>
                            {% endif %}
                            {% endfor %}
                            </div>
                        </div>
                        <button class="swiper-button-next"></button>
                        <button class="swiper-button-prev"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- End of Sidebar -->